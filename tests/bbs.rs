use core::convert::TryFrom;
use digest::{ExtendableOutput, Update, XofReader};
use pairing_crypto::bbs::ciphersuites::bls12_381::{
    verify_proof,
    BbsVerifyProofRequest,
    Challenge,
    Generators,
    HiddenMessage,
    Message,
    PokSignature,
    PresentationMessage,
    ProofMessage,
    PublicKey,
    SecretKey,
    Signature,
    APP_MESSAGE_DST,
    GLOBAL_BLIND_VALUE_GENERATOR_SEED,
    GLOBAL_MESSAGE_GENERATOR_SEED,
    GLOBAL_SIG_DOMAIN_GENERATOR_SEED,
};

mod common;

use common::mock::MockRng;

const KEY_GEN_SEED: &[u8; 32] = b"not_A_random_seed_at_Allllllllll";

const TEST_KEY_INFOS: [&[u8]; 7] = [
    b"",
    b"abc",
    b"abcdefgh",
    b"abcdefghijklmnopqrstuvwxyz",
    b"qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq",
    b"12345678901234567890123456789012345678901234567890",
    b"1qaz2wsx3edc4rfv5tgb6yhn7ujm8ik,9ol.0p;/",
];
const TEST_CLAIMS: [&[u8]; 6] = [
    b"first_name",
    b"surname",
    b"date_of_birth",
    b"father",
    b"mother",
    b"credential_id",
];

const PRESENTATION_MESSAGE: &[u8; 20] = b"e8gxekZpmeZTU0VDL9MV";

const EXPECTED_SIGS: [&str; 7] = [
"90efa1ee5ad3675a967165155c05c56d74b197932ff061a0cacd352979b6cd12c66303981d900f512d657f92795d74396e2d8916128cfbab7b55ff02890d7385a0b53639c98cd20b6f32edbed7bc4261906a13407fd9d2d94d3d85469c83d4a4447a63926fbd679ba0b71a82057d5f2b",
"8043aeaecd76366cd417aa9f9f8ce4b233b26b53426a1af120cbf57b2ab06de81ac231c31dd9e5f6e5c6c1dc0610259105ab98b35203d420190eb894f69fcf2130d966f97d2f32163cc302a25debe13ba9a2b79b2dff1b8bea57644f423cd7e71152ace95cad9a58c00a500e1b38fc03",
"aaf9ca17f5d72101f9728f756df0ef065ec04d45b5347d4b937cbeb6c90c081b2f0f8333ea8883e30fa4cc3601aae0e7176134e48791a4adddc939b2ad95199f600d35d83e04563fcadb3743b935092cadc62eb96450c6e9c798386a6ab2a3e89b00f76ae61ab81f19d4df8a718a7022",
"b01672aaefb1379febfac07ab4e0146bb84cc3205f7f610ad994fc4a7b3b7466b824dcc10abcd957c1135a93f3240be695e5ad52d67112f1ed90eed38058af6534cb0714fe87f65e05fc09fc9cfbc263eeedeec721c49e83d5048605c4c70fcbfd4b378d10e05a0c43846b3b56b06512",
"b1e56325f8417d572ee6bd4b908d8109001df148419e3535c3c295cb1d2438742254357a41c6f6f60d8a62abba47efc8e42f9b9f435fce57fce01536745b4529b74718960ccb61d390fe2e13cd14a75936063c258169d4c6aef12a9ef5102164aaf1926bdcc892a86786356f307c140d",
"8db4b8b1e2f2046f576987a6ea51af7adfc69bb1073fe82198848c742d8d7bb282563bfca94f47ff921021d3f64546325384dbb0a42a0e1f2c227d839ce44fab84048c61453d7c3720d6f893224ac552f35370490d58d91dd8784baf2e50f6254f9307bd0a9844d766f19afbbe400b2e",
"b0c6bfc00a75434227902f393a25783ae6aaddf2dbde40b2306206f42e3ec8b518545e4927c6a9453aa0b7a343a5b3dc499f5c4b7f49641cb8a887f2e3e57e2c858198cb23bdb94debeba07648e2a644c7d9f0b515fb9b87845f363f4b289671172a609af284b2ffa208358e40aa8361",
];

const HEADER: &[u8; 16] = b"some_app_context";

#[test]
fn signing() {
    let test_atts = TEST_CLAIMS
        .iter()
        .map(|b| Message::hash(b.as_ref(), APP_MESSAGE_DST.as_ref()))
        .collect::<Result<Vec<Message>, _>>()
        .expect("claims to `Message` conversion failed");

    for i in 0..TEST_KEY_INFOS.len() {
        let sk =
            SecretKey::new(KEY_GEN_SEED.as_ref(), TEST_KEY_INFOS[i].as_ref())
                .expect("secret key generation failed");
        let pk = PublicKey::from(&sk);
        let gens = Generators::new(
            GLOBAL_BLIND_VALUE_GENERATOR_SEED,
            GLOBAL_SIG_DOMAIN_GENERATOR_SEED,
            GLOBAL_MESSAGE_GENERATOR_SEED,
            test_atts.len(),
        );
        let signature = Signature::new(&sk, &pk, &HEADER, &gens, &test_atts)
            .expect("signing failed");
        // println!("sig {:?} = {:?}", i, hex::encode(signature.to_bytes()));

        assert_eq!(
            signature.verify(&pk, &HEADER, &gens, &test_atts).unwrap(),
            true
        );
        let expected_signature = Signature::from_bytes(
            &<[u8; Signature::SIZE_BYTES]>::try_from(
                hex::decode(EXPECTED_SIGS[i]).expect("hex decoding failed"),
            )
            .expect("data conversion failed"),
        )
        .expect("signature deserialization failed");
        assert_eq!(signature, expected_signature);
    }
}

#[test]
fn proofs() {
    use rand::SeedableRng;
    let mut rng = MockRng::from_seed([1u8; 16]);
    let test_atts = TEST_CLAIMS
        .iter()
        .map(|b| Message::hash(b.as_ref(), APP_MESSAGE_DST.as_ref()))
        .collect::<Result<Vec<Message>, _>>()
        .expect("claims to `Message` conversion failed");

    let expected_proofs = [
            ["b7d16b069d84e293b30cbece7b030d1be369abe23b9d2e28d19937e404056d5a123cfc21acf09a8ef4c7f406fa704dd78db9302b6f7ecf125f82fe532aaa425b9934b391bb289f07b1b6df064c99abb46fdaaaf9b67a1741f160847f0f1679ceab502dff1349a0e5a07543773591bc0e384b1b60f511ff1f4f7937cca95c2a8bfb84811552d8450adefb5e83e55e7e9b46da0919c3af53e64548041a2a7d7b47f872cd807271754f8025acb2fcee666c0301815fb90df1f4debec3b0ed026893207f5c030ba2d3540b4ea277ec59d7da1e67ec72650b8c74a0917e0d14ad13c0e51e560738f0bdbef8ef8767c08185c44123641929306612227e6fa37e13aff91495e51451d104108c9b56b90947804454e3ce6d41841df00d65346aaaabd8c19d470c836ca4bf90fef8ce10fe0ca42441657ead615bfd339f169bc5eb6ebc47f28da37b5b6877e0ba392adca48d5d664260de8638c49a459c6a43632472742fd670068419f2bdf938def532239061aa39efe4b2bbe12b513501c809cfe2e48ccd15f78526bc67aa6687859ef661b48611686938853ef6744a45f2f947c3b190a1d05924636cdbf723a94b2e2f1caf0a05d36ab998304d65ff1e106d7d8fa57534cb509f3f71365a59deba08c86858771418dcd2b3476ad9045767b8ecd7a57096329abeb2f04dc6b0c64a1d40ff78b8", "b65dc55baa78a70f2ae33cc57ebd93a269edae17233ec64fdb640095544e0b6b7a244c4fe4721da97a2463ee5040c7418d4b417795115080f9c64fee5b793e265bef4d54769b31767aa2a345e451a5eefd214f84c15b396a403c827ea67f3ec9aa7f08f72fe17b942ceb57190d1ddbd7803e92cb0e64d033bb88865c5eccc42c89fa7710c5a90669f8937e2f79597dce10e012d774c86cab942f6933320e953a98ff2472f099878384780ad0be7548a557cbebae9a1c8908338e3f24fbd57af856c35643c3cbcba1be0ef50df82873fb3eaff1aaf35fc54db2482f9f178b1b300fd8586026c0f69f40a45ab067d5ce0334301a69d9afa852f1210ac1def1b55ffae0afb2b29f2d26cfe0c077e346d1ed4ebfc82a51d3fa1ae261551a09c9dd3f8a9a8b1ca2362eef63917b8267783642497df17a6e71ba8dcc574c00afba80a75fc41615fc8de25857dcf3860ee9209b26ef694adcee4bccfc8731d733fda26a170c3eae71f2a60fb5d485fbf5c30ded1a1285799f7d5b32c28f62c079a21e2036527daf76c6b31cffa45e0da3786f2f04db0550926767e4e1ded12379396f7fcdcaf19fc11b29590ea4b852fdf8c1f551d5db48912ede3311cac10261ba1df12eb307c20f1de94e98fa0ed421d773e3", "821d64d92cc6650f55c524e740a07f294698f7e0b4176cc2b2e2e6d44de56084189ca373414d38cc0b42d58223a1cb98b67a59165120de73a61e36f2561a0ed85d41bb00038dd7fa8ab236167d700acb2a5c0b8166783788894317f0c1746d7d8ee17a74fb8d899653619ffb943b5c55a6b16539fcc7f912d3d2ffeeb7b86394529ba627ac8ccb9a1c2c32a1290174e75753b23ac062d4e27ce4477bdc276414151ba651414d19e6fd47f8282ed726a1519eeb230db8f4d9ff2e47360c305defd7423948ba68cf30a6434dc514a298753d6643fd30c6aa6dd42ed82266dfc84eed683ed16c0cf7f7a789593cc04915496560e86819d30e3636c7e5d0cc045c89d981743536d4d683079fcf2978826e8936eb1a2cd0ec204a1785815aa6dbf965fb230f6fbbfdd62ec1d557a5f474db382bda6d38526ed081cbd20fdcee0e5bc6ceab257ba5dd9734a115276c7b7438a42efd45a9338c0419f4bf9fffd03c21c572b71dacc0a421135d82602d9026e8dd105f4ddfbf6c03d0e88ad858339863e9d9862ec9d25361c6d20c3c37822b90480144052db677a71d6e198bef6e4463d534ccbc4b7f53719e2effddacd75d187b", "b8c0fc007d9e9a9e7db64ef91c34a172a46fc9325f01c7c26c2a2fdcd3bfddd9873c7a825bcfbc8ea45be9850cd6685c8bb7052f0ec990f36e8c5a4ddca076256a7a4bfa4380ec44a333925d166a5192d73763dd6320f553e61fa4fc77a5a237812836500d22e7b097578fd39d5f1b9194ef8b2ab404f74f47c6981275f556e5a4617fe7010af3f3573bf76c0501e57c08df2572a336c152e2a445c783ead46a46a9a345d7526caade38ff866228ded26ea37794668b10b63dd871c4db9e919a722a90a1b44910ab051e6382bedd3027686797703ccad21b8ca0b5bfde76acf4c5dedb7544f8b1abe4da439895f6aab93135d425d4abba595c855214c5fa27e98c9f3b40ab0d681b6d1bee10af3feebc2719c673ea8f781ff34210a5e3df0a73571159bb06e26808fb0fe93ba1c7d0b93e3735751028625fb7ad5de29bf10e9602a0dbbda96a3ba41ec3d48068e8a81b68a20cf497c8baa193df30d1f7338be06f6a1023748d9dbc8a9d389fd16fc5dd4b58ab687a924f64c97cc99d8c0a2f13d9426529efc95b29b3e268a237369eb6", "8653bc6d8f039597374fed7a0ce35d18b5546f632ce2f723391f2293ac4fd50fa8d6864e53406ed4c37817942330ea73a39c6aa2b914a3357c1b6df55353fda8912523261c51205ea4151f77793504dc069fb1b048385191d13f81827a9e7281afe4abb686cffe437c768dd2b62e6d07ae3049601947d36043f23fcaca04a6f0544d02cba2928bae00c0a0e911329c3334a7baf61c235e8406062fbc368e296e86e8f3a7796eba39dd2c5696460dbf994fbea2ba30157f8a9c76878707c46eddf129d80b2c9a72d0edd5dd4b1314c4ad4518585fc2aa5659a49c47732b6f529d7b4f6e1c4f9a376b9038a1c58ef1235b739d0714e5a99e1ec979ee6d20ac4c987cc0b644ad5123816d8eabeff50d3281147fbb97d15be2e4f9d9cdc17dd7d791f81567cfc72c822eeaa5732873075d511efee7f0412ab16897570d69d5115dc09a1e54210a4ba023b4167b5aabfef986417e3485e908656fbe56bfb89499da913f6b7c784ee34fb134c8210896452082", "83f80b2e635da5423544d7990e6bb3a098ceb07d79fad9cad038d40e76922a29beefe213e843c74948a4b9a68994debb892169769466c7d42a3a2973b95330667d99fb67815eb8fd8db78abcc5a0648dba22094839c8773c1d40b08bf7c249b084a10e5674598bf7c4604729ddfe301c73ac66fdf16da29bb847352bff3a6c701f2e7ddb36c23eace9fd60c0d2be4c61214508df2a12b77d3913c03dfa0cf0507f12a4304873592e3f12eda7ecfac5862ceb9a1a56aaf10833b67ce96ba966352daa0ae2e276d64244805f38817ccd4a258b7f5908cd819320c99f9ad039c8fa2fb3506afcecf92d26fb2432f438c66843fe6449c62e0afe1561dc10b0b56ac59651d47a81605f4308b0c900112e663a5455d3ed34c95377dccf0b03a6e032080179625083b01db7f852600b9d53b6222c13570e7cb8705b2a979408c4e33f41995d299bb867a5f6593f93fc783ee612"],
            ["b52152d8216b4e06c1f887366801f4ffde4da67d4f67b0f970c6060846ca27da494e1fdfa8c32e87daf409732d524a5ab63a41c52bb2bdbe8c5fdaf838fb4de83088e94674fa26b83d03599df29474d7d672d83871fd415e6b8f9d9a0e336018858ee29cc9bb2946625c81f92041910403d9447a630e2568d369700415f0a51a6082d91e90d632bed86debe1d856716148c5b4f74e6f0249b4bc7051bdf0e120c157cff31d6a7bb42b895fdb304abf7d14a73bc74a207790ca66fe1f8afe9dea9aba8ead7ea54eaf4dfe0f900ae8e38569a0b6a1f0d69fb95b5df92d88c2e93729967e117f7255a7632dddad6c2f2e703d3c1f540560036065c978b72110c67032e193bdff328c8b2e7a31434bc730bc4680a0dafeabf6c77b82605fea548206596d6cd686454f2c018a242c4aa758f636269eb343c10fd03ed260ec52d67aea13a9ea1d2f7cb5e5c7bbfec2aecfa2c245f2659035af7cb0c29ac894b6593c076608fbe51e7bab35713e70d86d888c7e4ad4125c8a09b09f2da41d0ca090e6a1bc50b2109703d7b4036fff0c4af206fd1301037c27eeaf4f85266278d79d7a3490944b8d0c713b1dc7fb0ff9c9015a6b2c16382712e95bd9819bd006ad3d9ee561296a749e73cb807528427e3d563ae06874f8d64dc12735e0192913044aaadb4b0708d24b3157620ee7bfc0f5c2da77", "a2eb79be75cd5818199441ba3cdf202333ec53cf03669b562906316959a91e9f58dea03ae8b10b8442e9c25c401cb8f5acd3b978e09964da46c499df852fe4736b531f7fdca922e68b2379fccf13b95084f242c499beee07e58fc4721ab50ebbb5e183d5e78129127d06cb0ac86e44f69407187166254eb51ede32c88587a1dee1c730db997b597ba0f6af4f70a6941e08428457d39b67381267049d08e0fca304154e182e020987e7bf4a01d743b24513ebe4357e25228da0e6f17db04c043f96b1d12431dcd683614e4cb768b7f1274e0ead47c5678240390b869537294be59cf9b8eb6804ed74abb9897b2a297da521d43a5a06381e28ad83907fb57543d152441bd3783495c95278ed036b2b57226dc0db9a8ccaff6a385cc78867cd9e31aba2f2344fa1a6e7e6ba0fb9e60a5de82e9ab3c4fb4006f5d8e796fa5c1111f79dc098fac46038592fffca7c1dd3315b729ff0dc088e1f2694438706a8e2a006279d8e4af157627d87d1b84f681f226408f7ac2a3084b84cf5aa450275d9caf0cd5e9d36682c626761b1941feff9048f4deff4a8c9be2328aa504a58c67083825d9c87cb71329a9a6aec86f87cde828d5b262309b64f4d96bc75b0bd3fe106e72f8413ae62b59b270f3370529213052c", "a55965b064a7493e324df3f103e420f0de529e45748bb505c5becae15bca7c29df62ee4c0b8c2cea5b8c32550efd4c4aa89cb5d58b4f8677890f6130d5b212610971ba241d5ba98f5482640c939cde092bf565fb3adf777995b4ec9379f843d894cb96ff2d5b044a928a1d70af1eda83c4438dca38e860c04bac22e4e05a1fea258f01b259ad83f5a7e41c3d4fcf09275bf3ae140245f0306efc85a0d016d9f9a5578c0ab5b4f6bb843ef6d0fd12f84544eba0633aa64c889de58c5690ff44c3df95b90076e9fc4c3bf9269752cdcc4a162faaecc66936294453268c63e74e5ed9b164a826083dc32004d2a48b8b09086d4ee7ed8e47091fa50777237d7da1a383b08a30ca96d5a2f2ed3539ed0548c8737485b2e04c94bf86dd8dd1fd61126b001b10d52daa3d352182df2c3eac2a4507a8918b02bd4c581518f38bc7c880dfe4b26987588e06ca74e4166b919ab7143730d10d482b937285e4e4650f472ea3a720119c90f5bc948244ac4fe8a7bae654fdcb98fb5056548ff1bef933a4c1f8b5559268effba916bfceaac1be27ff312dfed49a5c27422daab89e190d339a2a7a3c9f9b00be2b5d7a469f6fa98626a0", "a73e632e1fb522359eef403a7d55e5061db3c85e204a82adfcd7573d4236c766a6fd2e296b7536b296c29c1c3a42c170a37ffabc6b49bf2454a20dbdc41283d9b74748ac266a05b19deb36e4c1b35322617c4634e2140ce3482f7e8d22185a9580ca612ccbbae9ec691d9d94b068ea7eca414d6722a6019151d115b70d364ed67b996dd1857cd4a9a2e5fb12942ddbb4605e24f4399b3d0f373ed87658545e562257e337a5c8ade36384dbffd6d8e020724858871048eb5cf9776dde47fbc868826de5683cb182648e8549e7cc9e16fe0c4c63d10ed3fe93d4d90a5d9d1b8b61665c64511b47d7f9907a92d30c84f2434ea6894b11f24947057b1f0d32e414db8ddda879e9a044bd351f1a1be6680a0c3c9c3c3e5874425f8378ed2ba399abdc5c834055de5473c4bb96a0791907d5ac2557ade53907776c96609636f78735a9c842b47c2c5e9a794d4d8d2395fd03d821765fba0eed8765b77056593fae5a911fe1f9818817f62edf055546a4a78c1519e565dd0beec82e57d2584885ed5dace6271d7712089d552f07b6a55ce7f7d3", "b211bdb87901b1b295299a674c3333b76bef238c59c419dcc40e373331b386a97715dd9614cf7c3c3968ad497eb5b1c6b0ad848ede225337f3dc782996457dfa4fda599dbb5938e81472d2ef9bcfdf45e820211529aded1afee3ce16dae487a7a7f1dad46d661365de082fb175802ba95747c72e010082e7fa50d23e1e3cbf0bc99d2311cdcfd47111be91b84c12aed304576454649940e65b161efae73d16c8938753fe32b140170b7da0023dc180364bf76e3946cbeff2dd278339da27c9330589e85da465cead534f1cc74102bd4b0c0b8b14fd84b23c0bad5534f4b21e742a805ca15e31530fff62e2238df6c7732326ce0479698346253429e8633f1049abaf2c52fda8ab1621e101cfca32c2c30856f208ecdc611c5b62204123be490b4b2cbf1ebbfa90694f01699db712fbee1413a9e4877bcd52fd9cbb817a29d80b47d13bf60aed6cc789ede3b7756478e772e2ccbf0385e7b3310e5faded62b39e3d7108fd4060f65faa9a0df7e658ff9c", "8ab04f0dd22f9fcd5ab7b20bf664eac224b927c4240d7ce8dae38c5d44c3cd2fc435a46c547e2d6bf1c820c2fca829708be872695b760dfef0419eb359a82fd2650fc2ccabda6ee02bca52bc9f694ffa2b257e7563d4f41ba7b677d1c5f25fd693e992f430b9abd0a478bd08d25c7741d9c0b1ed79f229857bf725ae656b4d14cefd9f75ccfbf1d1d063c89fe05637e071f5f8918f530f6a79d2d4d5f9fe1a4e3c692651808b1d0a44c2e5a714d0af2430373e509180fb551f895c70b1d1f1dd85b75adc89a8100831329ab95b68d1a15a249e9b051ca37bf90a0306a22d9472b8857b2d58fe1de812abcc5b9026e5ce2826b7b442438a8047e30c2fe60f4b9656527f35b1f5428e482ea2972ac0061b3a24c1ae7a9f4730c6dc802ec9d733f7c84c3b4cd958f9750ff48a62c001affe34dffae7cd78c11cd3e8007994338cd9b139b0626c50e48bada1c1d24aa0c65b"],
            ["88acc81528a4be85b6a41cfd7450523790d9d55a58c90ec7f1cb46de004bf45574ccbbee746f369885ed17f06e7d6c37b7345f8fd779356db67a48d4e8af3bb49b9be547cf261e728f95ad568ecb2f947649d53438620047332a06f42c509637a00a1b1d1f5e820c6b610ad1374fe24ae283e1fe9ab8e24861bc6e95025bfe2c5fa23c260ba0b003a72c3d20bf8365bf22c30cacfcb86710154ec909e1ffd6dd56a905d8a51d6dc79a580fa129450b13245c5a0af43c39ec1a63fc18d5ae4e91296d531df18284a8f8816ce5995ea290418add092b3f55e07e1c2e373577294cbc5e7cbaedc158e2ac8fe3f30bdec115620dc6c29ec981ae098b8fbbf18e7d3228da5ddf8646d81165328f1412eedc9a0cf252ca46249492a95313bd7a327ec288ec7d3f46484c8ae63f805e484d06de40f90d98e80520b073cd122458e953d9f636932ffe788e6a326e0884f004098a71ec84903730fb27e7d3269a1a188adf4b16869fa25bd0d33fc8d949a70116bc296c597af796a36551b284e38eee810fc74f4199b4c7184b244a4116e571df7b669b5af7d19d2dac05d78562f6cf21b17c579c7b35b882d4536c44b5400daaf2553452291397f04efa5682f0f49530c74985cb500ca56ff9ca40a71bee57252440d6237d5c17430148cc6c4cfa2aa28c89ae3142a093d166c46e8e5316082bf4", "b1730c1a9b0523816d182a5bb8866652a24dfb4acc4997e5849c1dad4ffbc7cec8ca27e062251e089fd2e73c203cc4e796a89ba3a9dc5ed369a0502a8347b03d8c39a2ee5dc0d917448d8c15bb2bcfc94144b8c9e3f60e76443b4cb4a9897e9aa33f49bcbe5e60ac837f5f4d97a4d6bb894ecfd0897e0abf66ad25e5fc0d313f1691f5efea8b1b418bd1ef84ba0455e3329109be5608531221d1f2cbb4d53bb53b2c7a9375829be0af5bffe95f8488865a4b7387f8df6c1a0f95659eb67a2b4b655be54e5bb56feebefd70dbde1fc8b160a6c31d521c4cf0b26e8f2e95579653ac6386fe7a71584be30b70c047016f02221d515f459711eeccbd770041718d9c574ee132733c0d1945ea3766191475e442ac116126c197a96db300ec43bf549998676c731ac369a8f5101a39beea3ee147c814b87fef608c2651fe0762183789a8acf90928bdcdbd4316f0a23ad9796d2cd8da3bdf7c3121977cc2c8412cb0851623f0c171826115b91c9aad896554c50a96d94297e4a0faef22f89f7532ac8b241d003cf69151757f8a0729ce13e4b06dcce5179fc9966c2d61ff2358787c0537d525e0b02eb82896d3f57f7a982ee34cd6efe67caaec069ed848031a45ba431894a4823c1e9357054aa1f34203eb9f", "829a689308fe06c08334ca498e42a9ce40cd26ee43881e59183a76ac12de416bd2b64b2845b3ceb01e0503a37cc44009a469064336714085a9caba0286b79d90d7d3215c872f3f3abf88a5141315e5a2ad5594fe79c378f9f40ae85017c79d398d975c134530ca5264a38b8d617abc4ced018671b32b99a42108ee70417b456426ad9b0f8d9d4c6a7a05763f3bfd096d70062e0f1b23db07fcc8a769900992c40afc86bff4624c08e8b2e350cfa67a4149c491ff676cf6fcba06ed01071d48bb6b2e17661d61202111c2d3a62f890f1a36bd6d0de28dfe7c95f030bb2b5cc36698d5fac299d24620721ecfe48f8c384c3aa2b64118335c37792ce4fec05368cf47fa0d907f30cedd423a0e51af4bea15328bf6ab87d79a944febd46e77b1f0fba4bf6afea95a70e98ec4cde4d8169bfb484b97e43c4745495edcb0592c3024c7008ffb9dbb3a1fbd0c3274d22292ac225bfd1c3159050892db1ce4903ab7619f0fa6fe1144ca3433f796d05991a6b19967c98a4f4077bfe7c4ba53cbfe03d40ae6af6a6b191c276110c511a2261bda85530abe905ed293923630f8334e2beaf4fd418b269899e9a0b1dda300f0301ae5", "b28ecad80352b05c35d98449078e5b80fb026bfaf1ee7114ce2b2cef3aef09e44b96983fc3c0b95be0fa4fbb7d4101afa8fbcba3a42d1882254bdddbfba50e397440b033649306ea6de3a2dcc1d1c5aeb509789a466577ffd944e914717ae76ba3fddca71edb3232cf263b21dde70b3c27b892031bc314a77d268c7a0a87ddb38b586353562098b023e5f12deca17bee1c6ac168a87ad4b2cb152a2d5dece3774889f92e7cdb5e05797eac0757496d260a9427fef99bc08b32f2b382aad49b0a2f4fc9b4a4cd2e162247506228dd214f141a2cbb9f24a373ba5752dc1d4f031956698526eb9868c92650cd679c5a125554e61840632943a5d0be77e495be47e552565321b108e8d17e607aa8c35900d76669b4cf6c5852f256c9d077297deb2de28323ce0ee69ee3c4383a7650eb54c31eaa9ca73ab8eca6f19ef993b730106dd68be3faae08455eb03ca097e79cabf22f851e60553793ad32e21de0e5ae9eef24e831c4341662383f7c9f8dd2625d1c01b44f847598f18defed365f0ac4c19a298cf0c33d334350cb9f280cff0885ae", "87f6eeb336c5dfe3f0f2a28cc46b53352815d8e2558f3ee01cb8ef7748f7445aeb98aad21308baced8ab6ee04f42c441a76f9fe0564be7097c307d94b0e4df62809475aa8cc6d55edb34fbfebd50f77bc136aaf01871dbd306980e2c674b69188a8ea705928ade8a05eab65755feb60456a6184151e05ef7a3f1feec4805c76a8ec3881f8b4a68c4ebf514c3003dd8d24eceed305826359a974e1a5819a714e1fd4d9623f57485867e7a29afabb6af885720d6cdf2026f0423a8262887158f7faa5284e5454b4a7575337f52c33092011b6ce41409f7c85fe0c4e51f6d34c9734184ba3b38c4fdb201870ea5b2100313120d2df3e906289eeae09ae05699b786fe8828921af61a07958adc6bdf21b8534e7909d402530407e1d9da1e5cdb6fe08235a6bb1f9e0299dde888eccc0b9a831c72315f30a0c3ee47919fdab0053b8dcb1515cc92e5019007fc27dc72f688a828d0ab4967ca83eba4d93541aedde997ffb69d07323e1edae281e7abc49db51a", "885a823216b4ccb1b04d64b2c976b8b3fb6b7cb11daf24acb0832a22bf7e7d10dac85bb30567d5c4f4323f8475b12d6982a1a982f21fa018d4b0333bba4dbbd6893a57ba5fe805714df71ca93a61d2709e52476171b10737184b940c60a5523c84333beb1529d3ef8189ff34ee22a3a855e3fcdfb142766cc8e1dd5edd7be4b15f8e2a072894cfb30c7b7f385e34ba7917d589a41570a3e9357c9df8a1e3a3273e2a386cfc84df9e47a40e840ea4fe8551956f4e323a60321a4c9bf76ca8874e2ac05091029cc3ec9adb5ea29d8560a764c92adbcba756d814d6e0a3e035a997b644373e6c1bd6e521f9e208379f927d115cf120a26f2c0a862cf5f5a1357e874d609f2fb57d2e8d10638a94e142d26c559dafb7c08c30ce3b5ac3f4b9e346e121cf2d17f6493ed4e1383e39192ce46f67dbba98db79bf98c3f3a215445763a07d11f361345949bad9785f86d6aa5f5a"],
            ["a9a7dd74eec932db9ccdeff6bf9b6c9d7ce653388bd466ba65009e96e0e04dfcfa8c4cf7c7d9cf6b0e3cf93d84ae65ee932d0bcc11cf4fafb1ff5328cde1768e575b628338906826b669d9bacea016ce4462daf20818aac847a85df753693d7c84dccf7f47eb8f13e3a494add75215774a3698a5079aeb6bfacd4c1fc9571afd86ded38ba672e1d35f1d2def82fc6e320e3abd4f46a0699dc3f75bbc21c0e54ffd2373cf7ff9292932b872ff717ea07a4169eb6f23390e6223faa22817867b967dd1404b14e57fb0ca7cfc83912adf77522abcf4d01d33038364883c47f4ac1a8f26a0cb22c0c2e58a026d4928a4b41e05dcc7bf4cfa76a8b7b0ebbf6642c7cf76837d5204f8b97295f830d26fb0c528285ad934e6777d26a8aba9a678a864deefdced4d5e1c4415bfafc20c0f04ce71576baa6a88b8366d9036dc2227c8fd61c39e01657048d1789c7f2c4b62cfee15454ae229fb754cd14d55ac40367a5272a9bf0fe62a220d2579922b3410a0b03e0c4cbfa43e04315b8c3cb02ff1fb1fadce19571932fbe907f2c21332f4cada5f296b0a9cc8638855297d2287b4d46d327b0bed06f08884b2181603101da92c7f0bce27c0e44f3a118b485a3f77c920ae8d502985d6d3ceb6598e528a92ba54f920253f6271a6879c7ce8366548b0fe9744c64d6819eceab9c6931f07a3bcd426", "8e4866022df6f468ab6f96914ce3f4063efa0a577dfc323faf041d5574231d37c99241bd92dbd298d043d1ab43559478872f293749f8f5096f021d91e0c2e0b7f056f4d4e0af4cfd53aab91435755c963ea9c27c6c7d35837a955dfd60606198a9e80bc32ae8bfba5f6f35ff39b5318b65f824da509cc3534304825fe9e07fc5a356a8dec945d3be5cf8322e33b55c9e2dac5cfa1c5c67f1e155f45e6b83cbebcbf49a3f9033a820591347fbdfaea38118ec916cbdf218564f24141a80fc74a638ba86d6c83ef4d794bc670f5e26040301459c2ca375c907468334ef3ef173b0f8a1ffba4db1ebd66daa742f01a45b621339be36067e481ad216b0350aa5468db809bb4d469f44cb2551cae5e55bfe542f9f48caae84e9bc7dfa451047830f96496126d91d0c2812bfb4d5c1ef9323ce0101bcf6e6d7c9fca846d19e070c434bcd2a74e4d46afbc53b0a5fe2cd803404121364c5b75ac7d123ddc70c23fa6bd6e904010fc820297546ae21f86b6dc1e14e7b63fe9ceff9f1656926fb2cdb4a0f3ae55929defff27ea46cf8aced2ca8ef1f3a5b16e09d1b23e46df7ee9529eccdb21ac324f32805b7399ce1119e235e090e752d1d19ffc71eb81b714e59e3081e03a026d5979af4af2c5d7d5206e2fcc3", "81bb846b9720e2cc3b4c952497cd781cefcb8d4f1676b412216ceb39aca8d33de936dae705150e29250d894ec98a95598202533efce9ab0d612df50edea0806d57884aa24793c38dd9ad4b6499235efb70100f3cc3ceb914854a50d6db354293a3adbbefe98701e7d253202625b876795740ef5ba46282f26c699c208490f02d662f2832b602042ad6c01a9f0e4fb10742e85d367fb7e52308b93778af4fc710596f60c9faffae909bd53d1c845899094f2ebf3a6b7e245372b99980740b321d65b39f3a37ef7f0af024ef46d86fa3b009b5cfa1e6a8d2ba4a6a0c5996a9699fe9b6060501d60917ff01bbfabbf5dafc27809474eff8312fd1ee45930cd324d6a1da0ec0c1f88d42305f3a8c5e1f1cec3aa6c445e973fcea957c7148efdafe48e0b7471787bb3278d622ea6e714f03b97348070e0505c4a4f82160ab24dce9c3f2e6c58454762c5232f1a294e4636356332793874129c59be7291d670331075d3d7f720356c2c43882790ef7000a0f1a3e152fc51a2398d095b5222754fa3ebf4b2b54670c738c864503cd1038c359cf1eaff789b95463f3364f54d03b01d1a3ff73b4009d5becf4bb89ac8deb1ca008", "a144972e92f59daed9a28202bfc1911edc0c933698aa49b6c47dd00fdeb12d109429257244a48814de4ad9aad853e6e181254bc15b80e605acc5a5ff4386983f2b5e0cdc90f46db003e1cab097398374d2c483a8731716e5fd66e829b2cc5651a3f7071316232342930ea26d990222d250937f0d0719c1c1a9b35f24e839270d3c18100a994a336a5b56ada068d3c78770da3aefe325bf7b4c495454f72cc6678a4cdc6f1b1a98f409fa1d5448b52d7f02efea4f1c63640b7a8a8186fd16ecdae940225c06c6d817b58d550f941198c4510c4bbe4fd728fe489d7882f7280dd4c81b142b76d5bd11828eefd90049c87940d29ae7849944ce493d7ebdbed40a009f07f4e635beb1429ab1b88c2625e7ea225f50cc6bf7c8a3afbab11ad664cb932e8f3c97133dd1f9d66f30bb5391c52e36e27aa2ae5000b6d9bd7b3f64c96f9b23bb5551acbea7f50047eec8cdfbfba659edccf968bc5fae18c983a711dcdd3e5176ec0271675d012eb7b436374fb3b24c052836494eccb2ea3bab2b48bd0eb8c357a3c38ae718427b1ab73cb9f70b14", "b1ac847443d60ad57826e54a1efffc0458ee1f23b305439c5df94e808a5a529b8c5c841c9dcf2845125695a979f9b213a35fb69f8d4a990a1546dd3e5a0f503cb7fcff8f0b0b0993d99be996b44391925085896755444793cc85902ab353cfbb8c3857aa9802c89b608edff2e2b036ea38e7fcb0b827d9356f27b1e3201bf193aa97b6861fbbd9acdf1485f012a97eb029df08d0ca7e79bfe84f4a624f413ebd3c9fb085a061e0ea04881bcc757cf79f1c05fc4b6589be346537d1c10902cc208117504a8c8c918def349e602a9fca1230f534fe2a632b67c5ababde70e44ae459e3373c28b0469c2f5d38ed6bc2823e05e81178a8032649d9eb2490ab5cf35a67700504d7daf734e8c0cd3a72d147cf407c877a337dce1d6b20886c479f0c575e9909f385cc168b7f7d6ed274d64d9c593cf738882ede06cdbc604bea407fdb28904db7369271efdf98a940e4ff890a0a972a70a0172e566b167157e3f0a89a5fa1f2c962adaf5d40df86682af445c1", "900f25331a1de5b9c025060700c03448e55786bbda17e6225e9e4ba94c98df84b3209845a3f1855395aa509c444f554585d442d406a7eae04badc84c4ad2576c3ed1173da189372658c9ed1b93560bf87c756d4032c2d63ba1c2e5000d896a9184b5dab137a70254f56516ed18f78a63d3c41965bce1d3937d9e1074c4f8ceadf6020b90e0eb9d4c3e5183a46d572ebc136b70c01ceda68b9d2bb2067ed6ece032b4d1c9099abd2b0b9a082db196117358a820f1182567c899b064c351eb683fe9cbe3bf077ce4cdc55e02a79e62cf3c3f8e2ca617dbdf17790961011707f89942b0abceec371575546876467a1c0ea24d168ae01d4a15085dab14866427669351f51d5b206dab6f92162aec615072fb1476a639a3a9a2fddc1c4f64a09635a4f61c5519b6cba284bdeacefe8e56abc6182b432b363c4a2b0b0f047e86267e904872a4dd92a1520cdd261be6fa165af7"],
            ["a80d4d84fe92ad3ce830fae8e70a4b6fe882961bbe2d7252b5d1c02109293e3b38694688afea20cc4a4785ade52d1a90a40c5286f4c1d62468291a31e082543788383f1b78666728bb88661bd939f1d953f587499466977d3d11703fcda24057880017275f49954ca1ba7884de5cf9a553021d6c37c27f05b4d5defa7862ff2ddfae11b308ca19df9ed15b6a1daed3887205e01d86d1560a4c0782b8877ebb04c39483717a2fabf258aea290599c480a17ae49d8676c868aadc95308391eba29131f194d41bdad1fae678b982710b210407162e6b7040c68f4ae7f1fc8ba4d6b942df1543cac5d7fbdfea1d9b8afaf2b72695de5f37bae65164b4e83c76b3bd1801c1926477ee7bed79db65e74bff0965aae4feb8ef26f061f938f7c30106c65b95c4a9c0554c8cc8982491f30a1fda628112e7cc162f071c6ed15d3293080b2696d50e98be64787c40536309a171dfd4325c265961250654ab07982f6bfb4b7a24f84afdbb72a9fdc8c3cd6d13fb42e36970bfcb4de79f47dc7827c2729e22384b902291cd4e0a1af42e4a37b61ebda57fc731cd415cb2e5c6fe7aac5e2f57226d23fa56eb608d75731704e5a223ef001bdf1ef57a84919286ef22a4947a9f828b010f4eb1d11f7da05c8fecad8e7c530cfffd03c948ff7176b94c11a55f7b1a1e99bd71bd295cedd1b227384efea24", "ad8f6fa150933e7c48be8c84ddf3a488332f131a5856f43678a34e461485b311ce284a52cb5505a97ece0cf3f1342a1ab49527b72a3bed9728f890b691473e44433d2219db8f57e3152f906fb688b82c0373ebce33e62e21252e94aeb99ca2d9a9e339bf6edaade0f8de04ec3392a31077d615b0c19221a24b088d237a902826d43516d7d45147f0e4257c5129a5c74d6b5b27548fd244b0cf4ae4a46f262f5664a83455ebffa786306f769e2307e086693cd08db44792fb13cba069b993701ebd0a15a816d6f649cf905aef998f5514520b395e006c081797e07611996f5a6ce84ac21709e02dfea8f8b6714114ff393a552fdc8fb1dadc64cb63aa0333dbf7f4dd70d1e2a7df7b27e94df43cde1c241862a5e38b34f9a766e71aeefded6ce649a9cfd6943ce26e45b3b0784c77f3325fe87143d6d4591d126ee4ba98235fea34d8649dbe5885d7068326be38d18e2b4ab165b1659060d298d75392437315b6edd340908097464a9f5ac0bd855fd7a75301c8162874bed8d341fc69786dc421e269cea82e493854e344bc886f5bf3715f5364356d265de89e1a76942f4cd3b0092449be4840fbd50395c375d7a4df432bc4f1262246f5942cd586efd71e02b09f3898295562bccc8254d2d3098e8f36", "8ce7ff545877910886b0ca641ed2d5a1c9d233ffcc9168b70b4715f0f8989afae52b8607c4aba1712959b4a6643cc056808f708bbfe7ec8a854e34614424b8a1fb035d989991b60a7d43c358c6973e1e484e2244f0534f1873a421ff218aeb8c950b53d1671a5e62532d177805172214070da220ea1d28cde13b76a2c0629480691172235ba7dd5d9e158aead8bf97e1279a892edba28fd21d18654f5a81bda0cb34afbf102b21977705ebbfae2c3c1d54c12f8c305766ee3325b80860d31b2fb1e1e18f28f9489f057a3d0048d13cae50cc777385e491b2780800ef39e17910d55ccffdc9b01cecebd9c33cf340b6636cfd8b962e5b67454b937d9217a194f69f76ca89142c525c37c45d010ca6f578072bd6d9267c386b5e62a3de6b288a9d13fbc7ef1a66c9af34b0a2f2f268509b3e0039afcda8e103f8aa65669519969632999ce1ab14e0e42f52f4c5ef5ed2f836b8646052cf6af06789ef4051ee2ce44a25c8ddf52e6281bb0f8f80e90996143c6cc09ca918792cf1dd2bbe9841a4bc2c8079e2fac94df209e76bf0fcf298150a0bf70930efd7810f48a945fe1551aca6de6310748e9251635f36014b937ba1", "aa50a72ae53119d67c39b550ff1cc49d777fba556549b7e897605895747b50e9ec7e83f1c88c0581176261c0aee2debaa6a0aeef20e17384e0b40d4d704dd6513eca4b5410ccd01d073a96f1537a3caa857cb79fd8ba0c1423a714b529fccced89ffcda4d5bd205fc260deff6babc10d84742896b114413aae3c6862d827e7426e987d69181e8d45242ae9bc297b01645c25587e7280469005b4a8ccd49b22e9a2da455a2d5fdaae36ea2ea9fa26bfd84eda1427f0a47ba1f4ab2883871ce6d64c728bdf605ddab35c950276e34de1e339f51f3381d0314d79329e5ad44ed17bc9ef133ebad3474313f5b566dbcc3dc97361918abaec8c741c1c265ee09d2fd05be0bcc34931b9e91eaef7a3404467720d958bf0bb9a7f1bccdeaf202e76dde7b3d1d870a1368a63b25f6457a6faad9d68024b848d7db0b3f762b2b6a5a35cd743412c5de8517f778156983e9a152c16470c27562e89e76a82b6e31677f7d4c6fda55d564893744f4c117b13d747564d5dc1cd850a7f8133d23078d9e74f98690fe05cd9d45ff3ccfe0e3988fc0ca69d", "b9c6fcff741d68c95986bf11105a52d4186bff40bc7a785690696f6251476a7c7edf0774d9bebe88fb842f9b870e1c99b5fb47ba808466ec70eca2e066b94d09187256e693db56632949f57f1a22cb6268d5de1fa7d39f75a166b8030c18a967a68fe92817a6e4f7b68e0be7b54fdbbf6c677d155155c713882c0b48ae387875b77470e022140fd2376d39808e3ad60047e44c6a9914c3e7292bee771873909470c1cec748b649b95c1eef99f34165660f160fa42750796d2b209aa9cdfa65671a5e452020fdef9c6edd203b87084efd134959aceda2dc4ce674ad3c863ed2644e218d1ca70f1e9812e17828c6bfb7697336768e429cafcd70ed8844d755682f69b5e6a9ae56631b65365136de790615076e485fed2c36244011242a9241498b9ac7aef677c9eed2c4f12109e8ef92f219275a3d297006d1664f311b99af5bfd47a14b349ceaf89e3f39d346c8c05adb13bbc06926f2796ed7c313bf2d7e5f7e2b2a01e22efa58aefc15ce83d395d4ef", "8fb7c6a16ab87724b3829453acee8edfe5ef872a239ceca33d72a0cf20fb1a54edd497e00a88d7727ebb81ada432a9c2a59175e5f3af214f70f66b8c717dad14f193fe79e9b27065dab3da40808c952245deb91cbb56d74e8f7fcd4850be1d18b3813621119c8f251aa0717d24d391c1efedd323807839ddc9ac570d6cf8c46590416e61884347cb458fa16dc690b7225d2e6166795db468ed749327d4fee82105a1b77b39c0ac0979721641124dbe0c0381b5453ebb6e60d9efa81194dfad38766e16d5d486b7eea19bf3fe84fe64f9466ad3050ec3a93d4bc73362886fb61beff675016729062f0b17a8faa531ec2b25d7f3aae057f101c6670641a2e00111697a762e865b110af13d025f898b29571c628bf3d9980feaf7aa7c0b9da451cd42e0db66e1fe3783f5a7ea0734b8afe83bc796608e18783d658b8b65d51eae143c87448bdf946361b184f8eff8297a96"],
            ["b4c9b1e2f47e9f6b7f70e7d54bb559f2b984377091436cbfeddbb7b08f3dd7f7a1db84bb40b371b1099cd780aacf422bb772aafb1f0895f927bb634bb2a8b540500337e4d3f1edc004af2e0c3aef7af443c67d145e8a3357c322a2d5de794bff89359f3c2d1a51b0f10d4f72b8f7c4eeb694fb12ad1c709d9b944eee851f26df0d7726864ea8043c194bb7fb2981f1655beea7d5cbcb5dc868d877fc3aa3922882defc9e6ee38c9a41ea28e20500a92905cc0829dbbead8e5c7d323b8b850b0e71c8cb0d28c0a7a854edc63328cf685137edcc47ab82459401cd6adfbc0adba74710455d787080468a09725bc5d356d816aa0e1e1aa37b3c734813fb8fac8f8a79dfaa618ba33fdd9ed9ea2a0b93dabf4125a65fe9399dc70bb66a2af00d1a9423ac20b9d46cc7892b9f741017d4671b116b21a1a5549b11ffcad270c0a6af7bdc2bd19b7b7f89650f185d8685d8a829443cc4f85ead83be4933788a4f30ec159fca01daf2e15d3110cf6fce3cd03c8c20e54f6c34cafbd8e7eff01b2f737cb082ba48b0c45051c7ca2fc0cb6dc8b7c30c003e2921ad361867532dcbee26d1897344c8f03df90a5246f1bea23ef0ebf551922008e02f1a7d58e7a8c7648c0fb505fd5a1a6faf667a487ac83f86245a180cf4826ecfa35ac56b522e2a48a6eefdedc2bbe1f96fcb1789c9aea51767173f", "86c81b0c524c811d4066a0444a6c72bda828e1114cd6c93ba21db640144234f3848324fff3f6e3f87884e38f96b5f50289461698c62169b1970e34338fd1d372c9aa63a0ff61de2fcaa93284c401d99cecd405104d7338c314b77cb0bc899eba87b230855303fedf207f2cc568ea0db0e38e0c201e37a9ca4be127dc98f57ded46cbcb588b3c4aad03fbd7aa32b843f347c634a43bdc70e5fc60e673dbbbd1094c5365e88400831d181eea6931a527ea5cde232ffc0bad603a902a9b404cb911dfbddb7908509b57c29bdd155c178faf3bf455be11d5d839548d0ea82bc3b14123438e220edf123702dea96eb6eed1951acef4f8946f83f153504d5295e9103738862adef864340061d1a5cffd78629111bfcd56eb88192916fa47f3606d10de4549f2f58fa9a44154d875fee2168032071238525760804db3e947a29c12788afe535c0a571a05b6d75b3b490445a2e51fa839eba121fe0350cbc8c00892402778ffe495865e1ebe93890a2837b9032664bef2d9821b8208b6ecc4bdb8e998840c4b050dd71eadbbf08bd33b8fe747fc0d0c13e146f5e06158189bf34208759ec3c26e7ba4ad7328ae46b7161cbe6e5d3ab794f9b8b7d5e3e61703d51b6253e7d4cff868a0d42221d6d38b91a6051193", "96ce6f191078b584e27d2f89c4ec44a279eeb0b42f961f677971647de10473fde2570f1a8b3e21ee597f839637454d02b51c464ef2c55710e425a8ce923d2715ad2251aad9e59ead025e50a40cfca1cb775a771b5077bdb1161a0c239959292f818ca4009681578d0c0ef2167e1ebe2d9078ba11423aed889d06446c5399cf6d3459b70bdc20de12c3c47e0d4b0b7bdd28dfc0cdf5573bfe7471311a665160dbf6e1796f75b86220f78f59033fca68b164c953ebf1353cdc3445bbe5db61725450d829913a97fee4f0607dfe5f35d9e05c73640e72981fa65e790d55915facd7d22b5c8e932c064eeb2de7e4b56774f0253991eb2fc7851c4f99ea154d16eaff6df4b9d185fd40aeddf5f389267226fc5fe617e7af258350705890891538ef047fa2b5035a0a6cb056558a935013440c198610a48bbe9daaa59b9a461b8921c580626cc0946f4dd522c11fea34eac1f6111e22e02d8741521fb6b69d3f6b967471f6514c3f6ec42b423d90a92e8ce5280dd3d7a880a76572b8fe83fb17342b719b989dbfaadbffa6f95f1ae5323335993f5c2f600917c96b86bc50e241f5516c7bc588b4cf016d1cce99e2748141725d", "89ab7009f33c0f623bf71d79bdd7e50eb471c538688d05e808210695df3a363029aca76f9b1dbbd80b75e1dee26fe101aed715a5711ca4821314b3b25ea8fb962277909542d3f22dc12467238c1f169ee3d97163c274bbecc36c64489e36fec7ae865966f719162fddcf919adee2062fb818d4172ba85dfe2e22b7f322a32711b3dad829b8f97aef3f252fd2e95e76de621e8374f1c32be989e6e9fc4e8882869842637021fd090cc1659bd8cc197e033c8ed3b9f0dc60b673fe0507cff20a80de0fc0767232062150fa578ab3c507d949f9fbc724f08cd2a4f3b35134f428b3e0d52e3c2f05d87693df7729045d30dd36ed0854fe352bb89ba0057884540c26fb7bc8a6a522693e36e83e82306e47d5027b6822564d8b3e0ee3747a7e7778e5de888e0d94507cab9a4abb7d642de30f6be754b8cf2c6baab31941a7a6d0389b7060dbd7bb10f87dbf6ee78926490de96cf6a856766b8ae3285809999da5c286c63b7c5149e862925ff704d4c054f8656711ed50be2d2f61d2ae91cca31bb1294c7ebb03f6e034326a0bbb0522c302d6", "b92fb7c70f33faf3629370aca0699b9b830330a652b6561e8079b1197e4384725e6b7cb2bc600454ff5c3cd5681ce2ceb0446a68e44b138bb271f45aa079dc5539d63fd0789a825cb4e4fe832a953f19ae7fd0d9bf76d4eb5b2a6beaa23fdf6c8891f82c4f4ce13669cbc7d6122e00e6a6ced4abc8411e328e2203302d504a2f65ddd0b1cb30a2232096b7b4d4cd886631fdad435e8bc6c8feefeaef2cf8909b4fbb152b8b210ee9fd7f8e0ad7ad95945285c21fd0ceee3a04e3c76bf05b52e4634e847e6ab9e53efd1456d735b2a0cb66b89811857c50c11fb9c5c18d7f475c5e40ead3d11bd71ef66e98c059a7128901bd50e4fedebcc13c9781fb6171949bfb4a0952fa68aa14aaf2304c724867ee4db3cadfc3258f866cd70ba5efa2f24d4a5de6076cbe8ab6f7f28a946775bde16f9fc742cd76d63c7b9cde26d5344fb5b7148a78ae344b36913983fb54107d3712bd56df434844b7035798a55041e53fa932ce8bb37b8d6bfd39b29e8cdcc56e", "b2e8b06091f199ed0fc32eb6b7324004e8ca10a433c43be2863870638e3bdd9e95e3136bd10dc950eab2ce87a0c885aa8941dfcfed671f3e67deff7d81f5bce11aec626af03706590adadd34e489f9181b046504b99336490b366f25f7e666d7a6c4190070d794cfd96fda74fd3dc9702ceb03828f0602f5874c11b6e96ec3e5574b4f01b5ac02993f4bba2e1cc2a4de00cf3ab5ea4587c4a720da1dc1d2634c35e584599ec9068ad901d8d9dfadcb2c2c0c0870f6b2ad073959a1a8bae1c6389196e0179491c4e484051f91cb688d895f0c0c8e69bac273e8fb6c961fc9efd755926ba383d37861f80e3c15f9af91323e1fec9f65e046eb1538fcc28afe43a9453d53eb76f4f1806e699196452eb2432f9f23de529bdef0231cd13ae77983dec648c2698ff1d795fa1e88cea09dca703f18958a352b30f53ea6f5d4e4ca7c6a557985cf6c997b42153b6a42c5715679"],
            ["b20d24f9df657be53954ef31b5d27768887a29ad48e8826c9067246475ab1de8ad28db73b2bcbf8921063ff7e1482d99841f4363f9c0aa686419cc427c8af4431b2b2a92cea2c30d0b3e5da9e0695d47d85676c30133a0f74a4246fc67a2af799780236fab77240c7376c45235801b16be4b9005a376c866bdb132db34bbbe7632e5d52eba1bcf6fee513cde36b164ce5b098025745ac147f308b93abcd9fea27fba78e5a055503270d19e09c72a605d38d6a90f43a29eb54bf9f7063ca2fe15ef9a7c29fb7def8e987c93568c3c434b606ff8f23e599430ce60d4f20f747a4c7a9c9f62f6c55a67d501cdcf8d4418d43d7858ca096b54bbcd1ce9d10884e8f7d421d09f0706bce44be507122428954359e511507c1e9b442cdbbab41b572034bc5bc0f9d8ec4454e1d063a35dd2c05245d8002fdc4160bc827770778dd12a697dc5cb85bdf64580ab7452a972a7892603bfa38626bdb560d6a486d3c90ff23cf4a547f63cb942f03c5b820f9884dc111ee4428306bde7be281f8a8f0f2393f2ac9a180e6b8a64bf0fdd01feebea5277468041f6d239a4d12e3222e6b8172d15e2b017bd104d56e947a249d41bc697051e6afa6d5ac1d1b6e1a4612aa0ab0e2853e956410609acb4c9bf63ebb9d665ba31d9f4732998fb1cda727ca4eb47be827bcd2cf60f4eec8eefbe2126e5b6e425", "96c8600e3be02d46058ef0ee3d0638fda76511392ffa4df5cfefce0a49044b56d75b9a84b81aa8c9cf9ffdfd0b088cb5865a12c0f1f5569a63fc11e4482dc45f056c72b19819d58fe0dba9f376d67fc980652b40059f3e04e47634c1160afc9ab456ce1401f6dd39c89b026c3d474f71a913690a0360baa17fd4893c5aa92ebb436ff0ff5b457c703e449da382e8e1581525c4884fa90facd06c4b663c5c0bcf33a606315589521f8477710c5e2327d16075bad7002b585d8f244e481c7c61586aefed4f6b074fffa04134368006f6ac29b89c233e297f32404988bba0881e8b4a29c92cc9a5d690e01966915025235670810d13cea79beab381a7d1af3b1448c85f2a3bd488a73e8dfa2d0729fea2f42d3146b6ceeee48e82c776813a064bfe9a189a51515fd3e9a99661bd232d519a27c2c40a19611489507a21e83e1bfbd04e611e81cd0a78a630b326f7639d17215ba52f88731096df57ba3334e6b00152220d49767abfe3386a17a908e4df1c67511220f169eb6d9232a856646b856c510ed66186a6d11e2e31db3b8bd299d8b772506c66e7b78a394a5743f048e7489a1e12c3aa7623e98224fc2442c71acbb948ad0206e87916ad8a8a7610f5c813ce74bd1e9c2e37c1cabe1e6acc6da6b5fc", "8279f28aadaff340445fcfa3ebea9d5977ddc62d6c2494d42a6c863da08b20bc2e9d5687a1173009499f745fb95358da81206a72f3e3d5e7df8ccb277d86d515c5217db824ff5db4a6e0194c30f45dee4b1a56c27f974e1beff8a1e6d2d941ac84639fbc646decd004de38a88ad874bab9415076942669817e3bf9c1e2d1e72bb0b67338a4ea880993b83d2f2c86bc3222f2b6e4ed8d68e239ea2a9a35ea06947084a20acc2eaac557d3117a8e2c531c293b9759dd7b77ab3e4c17bb2ee901ef75e7ad5749046df1baceb608a8c90ff824c6a19f39ddb19b9977635998e98226f4a348fc7ef2107d5253209130d29cf60bf84207eaac12e392122cfc97dab735aaab25638503e169295bb207d678f9ee172b8c636b781fe739a23c2d3e00ea059b6d6376d688ff47d7884936cde5b3a62616202f4d4f256e53fa06a115f27aecdd9be961e6e7170a2d23711b259cd51017f01606b51283364a8de8295deceb6f3dbf999706ab76737d6241da95304bb848a732db5056841ab04a73ef6da8095507650e353e0f96db1dce652dd63dacb73461c565970a7dd625850e1520607df36c02e82ec1ea0fd31475570a553f4b69", "a3e16c45cc6ba5f1904bbba7fe767c153b0ccb6c1c8bab981456a426479457e96202d5b14860e281e9061b46aabcd7fe8d6b7ad748e5133aa065d7c1b22b8ce047e9a64ae93cce0f33a8608f0323317b30a98c81684ccd190fc2184e731a93a8883b722755cf4e6350b92d4deeb541156f16d142a40d3a6a63badf62c4b3253e381e7f6165d49afa11b4f93119ef2a3e5abb4a7149799c4295c373b602beb7780c60ead8c15343266a58edeabbf541f66551b8251a5e22a38fd2cfe3cfb1e76cd0a1b9ee46ba5b43ed2eb82dbb2c5b892fd649ccc23d2962b2ea9450dc686b141ea8b1ac59ab47be61650545c170578366993e58d59887933d4a7ab210c74eedfec0737f02ece0545235027b98a6d4f44c73930af3f6d50c7cc0a8caadbf52c037198ec5bf1bb73c433a294be656e2fe5516b06e11a902cf7028e4b5e971c52bd80e21942c20c397b527b27e0c0d743235131472c5d86a3151764d87dcab8055fc637e86e235192859680f8c74f6746958ee0c0373a271c61ad9be9362a784a19f69ba6e85ec1bdd9fb6476624823be4", "a97011b17f92dcfc2677e40fee0210d6a1d02900852a9d2792ea9e4f36fa3d2af3d71ca44f57f2b4fe774ad18a90b42480e3f909a444de686116a89e68d4b135eeee79da1242729e611292dacde5354efc47a5dd9c15644aed024b0b705af54597a35de29b9b2d89b6ee962ff1eda8539064b81562c5c0dfff3c4f55fb2193bde9201d720d5cb2b28738e104b79afa9e61ef008e405a3f7e7db6758ddf3fe1ba8d5e2c435fc5333ea2daa4c841562af14c570c6295f230f699643c755d913b0da582cee98b4dee38a65ec1441329b8c24ba84a84232439bd07049df016554b995fe880e611392cdc2418b5f648337aec56ec48431260b7fa2e4a4e31a85f2f25f514378d8deefb01e747aa35068e801c0475965bf017566fb80ca20adff14ac83c18a186b6ced70efaebfe9b79db29eb228df7ff064598b65741669b445373eaa838b6b5c75fb2ab85e547e0a63e76681faecff140851436b6cc302c715fd72a4d3597a1d7c12300b4c29b559d32ca6f", "a72d75b7b3e8987c6c0fc093b8396bcb5efd91a960ad3315797858832950dc6151f0cb0293e177a793aa0a2f98d1b3f4a81b016bfa6744b3a64c16b262e83bc97ab069125c86fb1b86831280df6e0e6e23315bc4297e79344b683cb75099190d8e7723035eb6cdaa84400b31ed07126e5a297a3bd8775ea791bab82b642861fa89ceed7097ed93dfef993bd320c3182b0179ed4dd9535f974c884b814d81183e56aecff321622a357b6662ee52bc0b353722f2e7ed8846754d721b842cb015a8d39827d840cf3119eff7775aa71a0bda61340ae8b9f4ec576baacb11655c7b2222c568e27fcb4b9ab620225d3185e8bc386d56da1c148ecd1546d9fdb37c9730ff9f226b7799867d985601a2b158fd925d68fdc8f40bab4fd59acada3bc403069c3d85bbcbcaaff82566ea6d86bc776e6a01450cf31f077d706d8b0c46d9b9115c1703c7fa7f8f9ce2fb80e1966db491"]
        ];
    // No presentation message
    let presentation_message = PresentationMessage::hash(
        PRESENTATION_MESSAGE.as_ref(),
        APP_MESSAGE_DST.as_ref(),
    )
    .expect("presentation message conversion failed");

    for i in 0..TEST_KEY_INFOS.len() {
        let pk = PublicKey::from(
            &SecretKey::new(KEY_GEN_SEED.as_ref(), TEST_KEY_INFOS[i].as_ref())
                .expect("secret key generation failed"),
        );
        let gens = Generators::new(
            GLOBAL_BLIND_VALUE_GENERATOR_SEED,
            GLOBAL_SIG_DOMAIN_GENERATOR_SEED,
            GLOBAL_MESSAGE_GENERATOR_SEED,
            test_atts.len(),
        );
        let signature = Signature::from_bytes(
            &<[u8; Signature::SIZE_BYTES]>::try_from(
                hex::decode(EXPECTED_SIGS[i]).expect("hex decoding failed"),
            )
            .expect("data conversion failed"),
        )
        .expect("signature deserialization failed");
        assert_eq!(
            signature.verify(&pk, &HEADER, &gens, &test_atts).unwrap(),
            true
        );
        // start with all hidden messages
        let mut proof_msgs: Vec<ProofMessage> = test_atts
            .iter()
            .map(|a| {
                ProofMessage::Hidden(HiddenMessage::ProofSpecificBlinding(*a))
            })
            .collect();

        let mut proof_values: Vec<String> = Vec::new();

        // Reveal 1 message at a time
        for j in 0..proof_msgs.len() {
            let mut pok = PokSignature::init_with_rng(
                &pk,
                &signature,
                &HEADER,
                &gens,
                proof_msgs.as_slice(),
                &mut rng,
            )
            .expect("Signature PoK init failed");

            let mut hasher = sha3::Shake256::default();
            pok.add_proof_contribution(&mut hasher);
            hasher.update(presentation_message.to_bytes());
            let mut reader = hasher.finalize_xof();
            let mut data = [0u8; 48];
            reader.read(&mut data[..]);
            let challenge =
                Challenge::hash(data.as_ref(), APP_MESSAGE_DST.as_ref())
                    .expect("challenge conversion failed");
            let proof = pok
                .generate_proof(challenge)
                .expect("PoK proof generation failed");

            let _expected_proof = hex::decode(expected_proofs[i][j])
                .expect("expected proof test data decoding failed");
            proof_values.push(hex::encode(proof.to_bytes()));
            // TODO enable this check once we have proof-verify implemented
            // as per latest spec, otherwise it's repeated work
            // assert_eq!(proof.to_bytes(), expected_proof);
            let mut revealed_msgs = Vec::new();
            for k in 0..j {
                revealed_msgs.push((k as usize, TEST_CLAIMS[k].to_vec()));
            }

            assert_eq!(
                verify_proof(BbsVerifyProofRequest {
                    public_key: pk.to_bytes().to_vec(),
                    header: HEADER.to_vec(),
                    presentation_message: PRESENTATION_MESSAGE.to_vec(),
                    proof: proof.to_bytes().to_vec(),
                    total_message_count: test_atts.len(),
                    messages: revealed_msgs.as_slice().to_vec(),
                })
                .expect("proof verification failed"),
                true
            );
            proof_msgs[j] = ProofMessage::Revealed(test_atts[j]);
        }
        // println!("proof {} : {:?}", i, proof_values);
    }
}
